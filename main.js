/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var m=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var f=Object.prototype.hasOwnProperty;var b=(d,c)=>{for(var s in c)m(d,s,{get:c[s],enumerable:!0})},F=(d,c,s,t)=>{if(c&&typeof c=="object"||typeof c=="function")for(let e of T(c))!f.call(d,e)&&e!==s&&m(d,e,{get:()=>c[e],enumerable:!(t=k(c,e))||t.enumerable});return d};var v=d=>F(m({},"__esModule",{value:!0}),d);var P={};b(P,{default:()=>w});module.exports=v(P);var n=require("obsidian"),L={jumpToNewPage:!0,openWindowMode:"current",saveLocation:"subFolder",linkType:"markdown",linkDisplayMode:"short",deleteLinkText:!0,deleteEmptyFolder:!0,showTitleLine:!0,customSavePath:""},w=class extends n.Plugin{async onload(){await this.loadSettings(),this.registerEvent(this.app.workspace.on("editor-menu",(s,t,e)=>{let i=t.getSelection().trim();i&&s.addItem(o=>o.setTitle("\u65B0\u5EFA\u9875\u9762").setIcon("file-plus").onClick(async()=>await this.createNewPage(i,e.file)))})),this.registerEvent(this.app.workspace.on("editor-menu",(s,t,e)=>{let i=this.getLinkInfoUnderCursor(t,e.file);i&&s.addItem(o=>o.setTitle("\u5220\u9664\u9875\u9762").setIcon("trash").onClick(async()=>await this.deleteLinkFile(i.file,t,i.start,i.end)))})),this.addSettingTab(new y(this.app,this))}async createNewPage(s,t){var l;if(!t)return;let e=await this.chooseFolder({currentFile:t}),i=s.replace(/[\\/:#*?"<>|]/g,"_"),o=`${e.path}/${i}.md`,r=this.app.vault.getAbstractFileByPath(o);if(!r){let a=this.settings.showTitleLine?`# ${s}

`:"";r=await this.app.vault.create(o,a)}let h=(l=this.app.workspace.getActiveViewOfType(n.MarkdownView))==null?void 0:l.editor;if(h){let a=this.buildLink(r,t);h.replaceSelection(a)}this.settings.jumpToNewPage&&await this.jumpToFile(r)}async deleteLinkFile(s,t,e,i){let o=s.parent;if(await this.app.vault.trash(s,!0),new n.Notice(`\u5DF2\u5220\u9664 ${s.basename}`),this.settings.deleteLinkText){let r=t.getCursor().line,h=t.getLine(r),l=h.substring(0,e)+h.substring(i);t.setLine(r,l);let a={line:r,ch:e};t.setCursor(a)}else{let r=t.getCursor().line,h=t.getLine(r),l=h.substring(e,i),a=s.basename;if(this.settings.linkType==="wiki"){let p=l.match(/\[\[(?:.*?\|)?([^\]]*)\]\]/);p&&(a=p[1])}else{let p=l.match(/\[([^\]]*)\]\([^)]*\)/);p&&(a=p[1])}let g=h.substring(0,e)+a+h.substring(i);t.setLine(r,g);let u={line:r,ch:e+a.length};t.setCursor(u)}setTimeout(()=>{this.app.workspace.trigger("layout-change")},100),this.settings.deleteEmptyFolder&&o&&setTimeout(async()=>{await this.deleteEmptyFolder(o)},100)}async deleteEmptyFolder(s){await new Promise(i=>setTimeout(i,50));let t=this.app.vault.getAbstractFileByPath(s.path);if(!t||!(t instanceof n.TFolder))return;let e=t.children.every(i=>i.name.startsWith(".")||i.name.startsWith("~"));if(t.children.length===0||t.children.length>0&&e){await this.app.vault.trash(t,!0),new n.Notice(`\u5DF2\u5220\u9664\u7A7A\u6587\u4EF6\u5939 ${t.name}`);let i=t.parent;i&&i instanceof n.TFolder&&setTimeout(async()=>{await this.deleteEmptyFolder(i)},100)}}async chooseFolder({currentFile:s}){let t=s.parent;switch(this.settings.saveLocation){case"currentFolder":return t;case"subFolder":{let e=s.basename,i=t.children.find(o=>o.name===e&&o instanceof n.TFolder);return i||(i=await this.app.vault.createFolder(`${t.path}/${e}`)),i}case"custom":{let e=this.settings.customSavePath||"/",i=this.app.vault.getAbstractFileByPath(e);return i||(i=await this.app.vault.createFolder(e)),i}default:return t}}buildLink(s,t){let e=s.basename,i;switch(this.settings.linkDisplayMode){case"relative":i=this.app.metadataCache.fileToLinktext(s,t.path);break;case"absolute":i=s.path;break;case"short":default:i=s.basename;break}if(this.settings.linkType==="wiki")switch(this.settings.linkDisplayMode){case"relative":case"absolute":return`[[${i}|${e}]]`;case"short":default:return`[[${i}]]`}else switch(this.settings.linkDisplayMode){case"relative":case"absolute":return`[${e}](${i})`;case"short":default:return`[${e}](${i})`}}async jumpToFile(s){let t;switch(this.settings.openWindowMode){case"newTab":t=this.app.workspace.getLeaf("tab");break;case"split":t=this.app.workspace.splitActiveLeaf();break;default:t=this.app.workspace.getLeaf()}await t.openFile(s)}getLinkInfoUnderCursor(s,t){if(!t)return null;let e=s.getCursor(),i=s.getLine(e.line),o=e.ch,r=i.matchAll(/\[\[([^\]|]+)(?:\|[^\]]*)?\]\]/g);for(let l of r){let a=l.index,g=a+l[0].length;if(o>=a&&o<=g){let u=l[1],p=this.app.metadataCache.getFirstLinkpathDest(u,t.path);if(p)return{file:p,start:a,end:g}}}let h=i.matchAll(/\[([^\]]*)\]\(([^)]+)\)/g);for(let l of h){let a=l.index,g=a+l[0].length;if(o>=a&&o<=g){let u=l[2],p=this.app.metadataCache.getFirstLinkpathDest(u,t.path);if(p)return{file:p,start:a,end:g}}}return null}async loadSettings(){this.settings=Object.assign({},L,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},y=class extends n.PluginSettingTab{constructor(s,t){super(s,t);this.plugin=t}display(){let{containerEl:s}=this;s.empty(),s.createEl("h2",{text:"\u65B0\u5EFA\u9875\u9762 & \u5220\u9664\u9875\u9762\u8BBE\u7F6E"}),new n.Setting(s).setName("\u8DF3\u8F6C\u9875\u9762").setDesc("\u63A7\u5236\u521B\u5EFA\u65B0\u9875\u9762\u540E\u662F\u5426\u81EA\u52A8\u8DF3\u8F6C\u5230\u65B0\u9875\u9762").addToggle(t=>t.setValue(this.plugin.settings.jumpToNewPage).onChange(async e=>{this.plugin.settings.jumpToNewPage=e,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.jumpToNewPage&&new n.Setting(s).setName("\u6253\u5F00\u7A97\u53E3\u65B9\u5F0F").setDesc("\u5F53\u8DF3\u8F6C\u9875\u9762\u529F\u80FD\u5F00\u542F\u65F6\uFF0C\u9009\u62E9\u65B0\u9875\u9762\u7684\u6253\u5F00\u65B9\u5F0F").addDropdown(t=>t.addOption("current","\u5F53\u524D\u9875").addOption("newTab","\u65B0\u6807\u7B7E\u9875").addOption("split","\u5206\u5C4F").setValue(this.plugin.settings.openWindowMode).onChange(async e=>{this.plugin.settings.openWindowMode=e,await this.plugin.saveSettings()})),new n.Setting(s).setName("\u9009\u62E9\u65B0\u5EFA\u6587\u4EF6\u4FDD\u5B58\u4F4D\u7F6E").setDesc("\u6307\u5B9A\u65B0\u5EFA\u7B14\u8BB0\u7684\u4FDD\u5B58\u4F4D\u7F6E").addDropdown(t=>t.addOption("currentFolder","\u5F53\u524D\u6587\u4EF6\u6240\u5728\u6587\u4EF6\u5939\u4E0B").addOption("subFolder","\u5F53\u524D\u6587\u4EF6\u6240\u5728\u6587\u4EF6\u5939\u4E0B\u5B50\u6587\u4EF6\u5939").addOption("custom","\u81EA\u5B9A\u4E49\u4F4D\u7F6E").setValue(this.plugin.settings.saveLocation).onChange(async e=>{this.plugin.settings.saveLocation=e,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.saveLocation==="custom"&&new n.Setting(s).setName("\u81EA\u5B9A\u4E49\u4FDD\u5B58\u8DEF\u5F84").setDesc("\u8BF7\u8F93\u5165\u81EA\u5B9A\u4E49\u6587\u4EF6\u5939\u8DEF\u5F84").addText(t=>t.setPlaceholder("\u4F8B\u5982: Notes/MyFolder").setValue(this.plugin.settings.customSavePath).onChange(async e=>{this.plugin.settings.customSavePath=e,await this.plugin.saveSettings()})),new n.Setting(s).setName("\u94FE\u63A5\u663E\u793A\u7C7B\u578B").setDesc("\u9009\u62E9\u63D2\u5165\u7684\u94FE\u63A5\u683C\u5F0F\u7C7B\u578B").addDropdown(t=>t.addOption("wiki","Wiki").addOption("markdown","Markdown").setValue(this.plugin.settings.linkType).onChange(async e=>{this.plugin.settings.linkType=e,await this.plugin.saveSettings()})),new n.Setting(s).setName("\u94FE\u63A5\u663E\u793A\u65B9\u5F0F").setDesc("\u63A7\u5236\u94FE\u63A5\u8DEF\u5F84\u7684\u663E\u793A\u65B9\u5F0F").addDropdown(t=>t.addOption("short","\u5C3D\u53EF\u80FD\u7B80\u77ED\u7684\u5F62\u5F0F").addOption("relative","\u57FA\u4E8E\u5F53\u524D\u7B14\u8BB0\u7684\u76F8\u5BF9\u8DEF\u5F84").addOption("absolute","\u57FA\u4E8E\u4ED3\u5E93\u6839\u76EE\u5F55\u7684\u7EDD\u5BF9\u8DEF\u5F84").setValue(this.plugin.settings.linkDisplayMode).onChange(async e=>{this.plugin.settings.linkDisplayMode=e,await this.plugin.saveSettings()})),new n.Setting(s).setName("\u5220\u9664\u9875\u9762\u65F6\u662F\u5426\u5220\u9664\u94FE\u63A5\u6587\u5B57").setDesc("\u63A7\u5236\u5220\u9664\u9875\u9762\u65F6\u5982\u4F55\u5904\u7406\u94FE\u63A5\u6587\u672C").addToggle(t=>t.setValue(this.plugin.settings.deleteLinkText).onChange(async e=>{this.plugin.settings.deleteLinkText=e,await this.plugin.saveSettings()})),new n.Setting(s).setName("\u5220\u9664\u9875\u9762\u540E\u662F\u5426\u5220\u9664\u6587\u4EF6\u5939").setDesc("\u63A7\u5236\u5220\u9664\u9875\u9762\u540E\u662F\u5426\u6E05\u7406\u7A7A\u6587\u4EF6\u5939").addToggle(t=>t.setValue(this.plugin.settings.deleteEmptyFolder).onChange(async e=>{this.plugin.settings.deleteEmptyFolder=e,await this.plugin.saveSettings()})),new n.Setting(s).setName("\u662F\u5426\u663E\u793A\u6807\u9898\u884C").setDesc("\u63A7\u5236\u65B0\u5EFA\u9875\u9762\u662F\u5426\u81EA\u52A8\u751F\u6210\u6807\u9898\u884C").addToggle(t=>t.setValue(this.plugin.settings.showTitleLine).onChange(async e=>{this.plugin.settings.showTitleLine=e,await this.plugin.saveSettings()}))}};
